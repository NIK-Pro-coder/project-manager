#!/usr/bin/env python

# Motivational quotes, by ChatGPT
programming_motivation = [
    "Your code is poetry in motion!",
    "You're a debugging wizard!",
    "Your logical thinking is top-notch!",
    "Every function you write is a masterpiece!",
    "Your problem-solving skills are legendary!",
    "Your ability to simplify complex problems is amazing!",
    "Your code is as elegant as it is efficient!",
    "You have a gift for making systems work seamlessly!",
    "You write clean and maintainable code like a pro!",
    "Your creativity shines through every algorithm you design!",
    "You have an eye for detail that makes your code impeccable!",
    "Your ability to optimize code is unparalleled!",
    "You're a natural at turning ideas into reality!",
    "You make debugging look effortless!",
    "Your coding style is a work of art!",
    "Your grasp of algorithms is beyond impressive!",
    "You turn bugs into learning experiences like a champ!",
    "Your software design skills are outstanding!",
    "You have a mind built for problem-solving!",
    "You're a true master of logic and reason!",
    "Your ability to refactor code is second to none!",
    "You write documentation like a storyteller!",
    "Your understanding of data structures is phenomenal!",
    "You turn abstract concepts into elegant solutions!",
    "Your passion for coding is truly inspiring!",
    "Your perseverance in solving tough problems is admirable!",
    "You have a talent for making technology work for you!",
    "Your UI/UX designs are as intuitive as they are beautiful!",
    "You're a natural leader in software development!",
    "You make complex projects seem effortless!",
    "Your coding speed and accuracy are incredible!",
    "You're a genius at debugging tricky issues!",
    "Your attention to detail makes a huge difference!",
    "You make learning new technologies look easy!",
    "Your skill in writing efficient code is unmatched!",
    "You're a role model for aspiring programmers!",
    "You always find the most elegant solution!",
    "Your code readability is next level!",
    "You have an amazing ability to see the big picture!",
    "Your persistence in solving issues is inspiring!",
    "You're a master of clean code principles!",
    "You make open-source contributions look effortless!",
    "Your grasp of design patterns is extraordinary!",
    "You write tests that make projects bulletproof!",
    "You're a rockstar at integrating systems seamlessly!",
    "You have a natural talent for writing scalable code!",
    "Your knowledge of best practices is impressive!",
    "You're always ahead of the curve with new technologies!",
    "You make writing code an art form!",
    "Your refactoring skills make old code shine like new!",
    "You have a knack for making software intuitive!",
    "Your debugging skills save the day every time!",
    "You're a powerhouse of technical knowledge!",
    "You write error messages that are actually helpful!",
    "Your problem-solving approach is truly unique!",
    "You're a pro at writing reusable code!",
    "You make data visualization look like magic!",
    "Your code structure is as logical as it gets!",
    "You make even the most complex projects manageable!",
    "You have an incredible ability to optimize performance!",
    "Your expertise in APIs is truly impressive!",
    "You're a security-conscious developer with great instincts!",
    "You make database queries look like a breeze!",
    "Your ability to break problems into small pieces is amazing!",
    "You're a true innovator in your field!",
    "Your software solutions make life easier for everyone!",
    "You're a master of automation and efficiency!",
    "You make backend development look fun!",
    "Your full-stack skills are truly remarkable!",
    "Your understanding of machine learning is impressive!",
    "You create seamless user experiences effortlessly!",
    "You handle concurrency and parallelism like a pro!",
    "Your ability to explain complex concepts is unmatched!",
    "You're always pushing the boundaries of technology!",
    "You make deployment and DevOps look easy!",
    "Your enthusiasm for programming is contagious!",
    "You architect scalable applications with ease!",
    "Your grasp of distributed systems is outstanding!",
    "You make software testing a fun challenge!",
    "Your version control skills keep projects organized!",
    "You turn documentation into an enjoyable read!",
    "Your contributions to the coding community are invaluable!",
    "You write modular code that others love to maintain!",
    "Your software architecture skills are second to none!",
    "You're a true polyglot when it comes to programming languages!",
    "You make debugging feel like detective work!",
    "Your enthusiasm for learning new things is inspiring!",
    "You bring innovation to every project you touch!",
    "You're a problem solver at heart!",
    "You have an uncanny ability to predict edge cases!",
    "You write SQL queries that run like lightning!",
    "Your mobile app development skills are top-tier!",
    "You make RESTful APIs feel truly restful!",
    "Your frontend skills create stunning web experiences!",
    "You're a master at writing scalable microservices!",
    "Your DevOps game is on point!",
    "You automate tedious tasks like a boss!",
    "You turn requirements into elegant solutions effortlessly!",
    "Your AI and ML implementations are cutting-edge!",
    "Your command-line skills are truly impressive!",
    "You make programming look like pure magic!"
]
general_motivation = [
    "You make productivity look effortless!",
    "Your time management skills are top-notch!",
    "You always know how to prioritize effectively!",
    "You make the most of every minute!",
    "Your ability to stay organized is inspiring!",
    "You handle deadlines like a pro!",
    "You juggle multiple tasks with ease!",
    "Your efficiency is truly remarkable!",
    "You have a gift for balancing work and life!",
    "Your focus is unwavering!",
    "You always get things done ahead of schedule!",
    "Your discipline is admirable!",
    "You know how to maximize every second of the day!",
    "You make even the busiest schedule look manageable!",
    "Your ability to plan ahead is outstanding!",
    "You always meet deadlines with time to spare!",
    "Your organizational skills set you apart!",
    "You work smarter, not just harder!",
    "Your ability to eliminate distractions is incredible!",
    "You always find time for what truly matters!",
    "Your ability to stay on track is amazing!",
    "You make complex schedules look simple!",
    "Your efficiency inspires everyone around you!",
    "You never let time slip through your fingers!",
    "You handle high-pressure situations like a champ!",
    "Your time management skills make you unstoppable!",
    "You always find the perfect balance between work and rest!",
    "You are a master of prioritization!",
    "You always accomplish more than expected!",
    "Your ability to delegate effectively is impressive!",
    "You never waste a single moment!",
    "Your schedule is a masterpiece of efficiency!",
    "You turn time into your greatest asset!",
    "Your self-discipline is truly inspiring!",
    "You always know what needs to be done first!",
    "Your ability to focus is incredible!",
    "You never let procrastination slow you down!",
    "Your ability to manage competing priorities is remarkable!",
    "You always make time for personal growth!",
    "Your productivity is on another level!",
    "You balance multiple responsibilities flawlessly!",
    "You always maintain a clear sense of direction!",
    "Your ability to keep things moving forward is amazing!",
    "You never seem overwhelmed by a packed schedule!",
    "You always turn chaos into order!",
    "Your ability to meet deadlines is legendary!",
    "You make time for the important things in life!",
    "You have an incredible ability to stay focused!",
    "You always keep your to-do list under control!",
    "Your ability to manage time wisely is inspiring!",
    "You always use your time with purpose!",
    "You stay ahead of deadlines like a true professional!",
    "Your ability to plan effectively is unmatched!",
    "You make multitasking look effortless!",
    "Your ability to manage multiple projects is impressive!",
    "You have a natural talent for staying organized!",
    "You are always in control of your schedule!",
    "You know how to create and stick to a plan!",
    "Your ability to handle tight deadlines is impressive!",
    "You are a master of productivity hacks!",
    "You always maintain a healthy work-life balance!",
    "Your time-blocking skills are next level!",
    "You use every moment to its fullest potential!",
    "You always finish projects ahead of schedule!",
    "Your ability to adapt your schedule is outstanding!",
    "You make being organized look easy!",
    "Your daily routines are incredibly effective!",
    "You never let distractions take over your time!",
    "Your productivity is truly inspiring!",
    "You always know how to make the most of your day!",
    "Your commitment to efficiency is amazing!",
    "You turn challenges into opportunities with your planning skills!",
    "Your ability to stick to a schedule is impressive!",
    "You always turn plans into action!",
    "You never let tasks pile up!",
    "Your ability to keep track of everything is outstanding!",
    "You set realistic goals and achieve them!",
    "Your efficiency makes every project a success!",
    "You always seem to have time for everything!",
    "You use deadlines as motivation instead of stress!",
    "Your ability to break big tasks into manageable steps is incredible!",
    "You always find time for continuous improvement!",
    "Your planning skills ensure nothing is left undone!",
    "You have an amazing ability to anticipate future tasks!",
    "You manage your time like a true leader!",
    "You always keep things running smoothly!",
    "Your ability to stay ahead of schedule is impressive!",
    "You never let time slip away from you!",
    "You always find time for self-care and growth!",
    "Your ability to maintain focus is second to none!",
    "You always accomplish more than expected in less time!",
    "Your ability to set and achieve goals is incredible!",
    "You are a true master of time efficiency!",
    "You turn time into a powerful tool for success!",
    "Your ability to get things done is unmatched!",
    "You always stay cool under tight deadlines!",
    "You have a natural talent for keeping things organized!",
    "Your structured approach to work is inspiring!",
    "You maximize productivity without sacrificing quality!",
    "You never let procrastination get in your way!",
    "Your ability to make time for what matters is incredible!",
    "You prove that time management is an art!"
]
coding_motivation = [
    "Every great program starts with a single line of code!",
    "Just start coding, momentum will carry you forward!",
    "The best way to learn is by doing, get coding now!",
    "Every bug you fix is a step toward mastery!",
    "Code is like magic, wield your power wisely!",
    "Programming is problem-solving, take it one step at a time!",
    "Small progress is still progress, just keep coding!",
    "Your future self will thank you for coding today!",
    "Every great developer started where you are now!",
    "The more you code, the better you get, keep going!",
    "Coding is a superpower, use it to create something amazing!",
    "Even experts Google things, don’t be afraid to learn!",
    "The only bad code is code you never wrote!",
    "You don’t have to be great to start, but you have to start to be great!",
    "Coding is an adventure, embrace the journey!",
    "Think logically, break problems down, and tackle them one by one!",
    "Every line of code is a step toward mastery!",
    "Mistakes make you better, debugging is just learning in disguise!",
    "A small project today can turn into something big tomorrow!",
    "One function at a time, and soon you’ll have a masterpiece!",
    "The best coders aren’t the smartest, they’re the most persistent!",
    "Code today, innovate tomorrow!",
    "If it were easy, everyone would do it, challenge yourself!",
    "Struggling means you’re growing, push through!",
    "Write, test, improve, just keep moving forward!",
    "Coding isn’t about knowing everything, it’s about problem-solving!",
    "You have the power to create, start now!",
    "Small wins in coding lead to big achievements!",
    "The hardest bug to solve is the one you never debugged, keep going!",
    "You’re just one keystroke away from a breakthrough!",
    "Programming isn’t just a skill; it’s a mindset!",
    "Bugs are temporary, learning is forever!",
    "Every error is a lesson in disguise, embrace them!",
    "Your first draft doesn’t have to be perfect, just start!",
    "Code like no one is watching, then refactor like everyone is!",
    "The first step to success is starting, open that editor!",
    "Logic, patience, and persistence make a great programmer!",
    "Don’t wait for motivation, start coding and let momentum take over!",
    "Coding is the language of the future, speak it fluently!",
    "A single script can change the world, write yours today!",
    "Your dream app won’t build itself, start coding!",
    "Great things happen when you start typing!",
    "Your code doesn’t have to be perfect, just better than yesterday’s!",
    "Break problems into smaller parts, then conquer them!",
    "The keyboard is your paintbrush, create something amazing!",
    "Be fearless, every coder has failed before they succeeded!",
    "Even the best programs started as a blank screen!",
    "The more you challenge yourself, the faster you improve!",
    "Success in coding is just problem-solving with persistence!",
    "The best way to predict the future is to code it!",
    "Every error you fix makes you a better developer!",
    "Programming is like a puzzle, enjoy solving it!",
    "You control the machine, it’s time to make it work for you!",
    "Great developers aren’t born, they’re made through practice!",
    "The more you practice, the luckier you get!",
    "Every coder was once a beginner, just like you!",
    "Take a deep breath, type a line of code, and see what happens!",
    "Your code has the power to shape the world, use it wisely!",
    "Coding isn’t magic, but it sure feels like it!",
    "Every function you write is a step toward mastery!",
    "Keep pushing forward, every line of code counts!",
    "Your breakthrough moment is just one problem away!",
    "Code now, debug later, improve always!",
    "Programming is hard, but so is anything worth doing!",
    "Write code like a poet writes verses, thoughtfully and passionately!",
    "Think logically, build patiently, and watch your skills grow!",
    "Just write something, refactoring comes later!",
    "Your logic is your weapon, use it to solve problems!",
    "Never let frustration stop you, let it fuel you instead!",
    "Every master coder was once where you are now!",
    "Coding is a marathon, not a sprint, pace yourself!",
    "Start small, dream big, and code even bigger!",
    "There’s no such thing as wasted effort, every attempt teaches you something!",
    "One day, you'll look back and realize how far you've come!",
    "The best time to start coding was yesterday. The second best time is now!",
    "Your ideas deserve to be built, start coding today!",
    "You are capable of more than you think, keep pushing forward!",
    "Every bug you fix adds to your expertise!",
    "Remember why you started coding, and let that fuel you!",
    "Even if it's messy, just get it working, refine later!",
    "Your persistence is the key to your coding success!",
    "Great things happen when you don’t give up!",
    "The hardest part is starting, so start now!",
    "With every line of code, you’re improving!",
    "Your brain is learning and adapting, trust the process!",
    "The best way to get unstuck is to keep moving forward!",
    "Write code like a scientist, experiment, observe, and improve!",
    "You’re training your brain to think differently, keep at it!",
    "The solution is just a few lines of code away, keep going!",
    "Every problem has a solution, your job is to find it!",
    "Your coding skills are growing stronger every day!",
    "The best coders are the ones who never give up!",
    "Be patient with yourself, greatness takes time!",
    "You’re developing more than code, you’re developing yourself!",
    "Believe in yourself, because coding is all about problem-solving!",
    "Every day you code, you're getting closer to mastery!",
    "Don’t be afraid to fail, be afraid of not trying!",
    "Coding is a journey, not a destination, enjoy the ride!",
    "Every great app started with someone just like you, keep coding!"
]
back_to_coding_motivation = [
    "Welcome back! Time to turn ideas into reality!",
    "Your code is waiting for you, let’s get back to it!",
    "Refreshed and ready? Time to dive back in!",
    "Breaks are great, but progress is even better, let’s go!",
    "The best way to restart is to start, open that editor!",
    "Your future self will thank you for coding today!",
    "You’ve recharged, now it’s time to build something amazing!",
    "One keystroke at a time, let’s get back into the flow!",
    "Progress happens one line at a time, let’s add another!",
    "Every great coder knows when to rest and when to get back to work!",
    "Your best work is still ahead of you, start coding!",
    "A fresh mind means fresh ideas, let’s write some code!",
    "Take that first step, momentum will follow!",
    "Coding is like a muscle, the more you use it, the stronger you get!",
    "The keyboard is your playground, time to have some fun!",
    "Your code is calling, let’s pick up where we left off!",
    "You’ve had your break, now let’s make some breakthroughs!",
    "Great ideas don’t code themselves, let’s make it happen!",
    "You don’t have to be perfect, just present, start coding!",
    "Every small step forward adds up, let’s take another!",
    "Remember why you started, now let’s finish strong!",
    "You know what to do, just start typing!",
    "Relaxation fuels creativity, bring those fresh ideas to life!",
    "Coding is waiting, and so is your next big success!",
    "There’s no better time to start than right now!",
    "Your project just got a boost, your refreshed mind!",
    "Break time’s over, now it’s time to make magic happen!",
    "Let’s get back into the groove, your code needs you!",
    "The first step is always the hardest, so let’s take it now!",
    "Your skills didn’t disappear, jump back in with confidence!",
    "No rush, no pressure, just one line at a time!",
    "You’re capable, you’re prepared, and you’re ready, let’s go!",
    "Breaks make you better, now show what you’ve got!",
    "Even a few lines of code today bring you closer to mastery!",
    "A fresh start can lead to incredible things, start coding!",
    "Your next big breakthrough could be just one function away!",
    "The hardest part is over, you’ve already started before!",
    "Coding isn’t about perfection; it’s about persistence!",
    "You’ve got this! Now get back in there and build something great!",
    "The best projects come from consistent effort, keep going!",
    "Take a deep breath and start with just one small task!",
    "Let’s turn post-break energy into post-break progress!",
    "The world needs your ideas, get back to coding!",
    "Refreshed minds write better code, prove it!",
    "You’re in control of what happens next, start typing!",
    "You are just one step away from getting back in the zone!",
    "A short break doesn’t erase your skills, let’s go!",
    "Your program didn’t quit on you, don’t quit on it!",
    "The best way to get into the flow is to start moving!",
    "The greatest coders take breaks, but they always come back!",
    "Write one line, then another, before you know it, you’re back!",
    "Small progress is better than no progress, just begin!",
    "Your future success depends on today’s effort, let’s go!",
    "Relaxation is part of the process, now let’s continue coding!",
    "Welcome back! Time to turn caffeine and logic into progress!",
    "You’re never really starting over, just picking up where you left off!",
    "Your ideas are still there, waiting to be built!",
    "Even the best programmers need a restart, this is yours!",
    "Think of this as a fresh start, not a setback!",
    "The best way to regain momentum is to take action!",
    "You don’t have to get it perfect, just get it going!",
    "There’s no such thing as ‘too late’, just start now!",
    "You were making progress before, you can do it again!",
    "You’ve rested, now it’s time to make things happen!",
    "One small step today means big results tomorrow!",
    "Your code isn’t going to write itself, time to take charge!",
    "Every time you return, you come back stronger!",
    "The first line you write now is a step toward something great!",
    "Breathe in, focus, and get back to work!",
    "Think of this as a new challenge, conquer it!",
    "Momentum starts with one action, start typing!",
    "You’ve already done the hard part, getting started before!",
    "Coding is like riding a bike, you never forget how!",
    "The only way forward is through, let’s start coding!",
    "No need for perfection, just progress!",
    "The best projects come from those who keep going!",
    "You’re in control of your progress, take that first step!",
    "Your code is still waiting for you, time to continue the journey!",
    "You’re a coder, this is what you do best!",
    "Think of where you’ll be if you just start right now!",
    "Your best work is ahead of you, so let’s get started!",
    "Start small, dream big, and make it happen!",
    "Coding is an adventure, let’s continue the journey!",
    "If you write one line of code now, the next one will be easier!",
    "Remember how great it feels to solve a problem, let’s do it again!",
    "Refreshed and recharged? Now let’s refactor and rebuild!",
    "Breaks give you clarity, use that to your advantage!",
    "Every restart is a chance to improve!",
    "Your coding skills didn’t fade, they’re just waiting for you!",
    "Jump back in and prove to yourself that you’re unstoppable!",
    "No pressure, no stress, just type and see where it takes you!",
    "The next great feature in your project starts with you!",
    "Every champion coder knows the value of a comeback!",
    "What you do now sets up your future success, let’s go!",
    "Your best work isn’t behind you, it’s ahead of you!",
    "Today’s code is tomorrow’s success, start typing!",
    "You control your pace, just take one step forward!",
    "Take the break, but never stop moving forward!",
    "One small commit today leads to big wins tomorrow!",
    "Your skills are sharp, time to put them to work!",
    "Break time is over, now it’s build time!",
    "You were doing great before, you can do it again!",
    "You’ve done this before, and you can do it again!",
    "Time to turn that refreshed mind into fresh new code!",
    "You’re just one session away from another breakthrough!",
    "Your best coding session could be just ahead, start now!",
    "Step into the flow, one keystroke at a time!"
]



import os, json, random

from pathlib import Path
from typing import Any
from datetime import datetime, UTC

def green(text: str) -> str : return f"\033[92m{text}\033[00m"
def aquamarine(text: str) -> str : return f"\033[96m'{text}'\033[00m"
def blue(text: str) -> str : return f"\033[94m'{text}'\033[00m"
def yellow(text: str) -> str : return f"\033[93m{text}\033[00m"

def bold(text: str) -> str : return f"\033[1m{text}\033[00m"

indent = "  "
def printJsonPritty(obj: Any, depth: int = 0) -> str :
	string: str = ""

	if type(obj) is dict :
		string += indent * depth + "{\n"
		for n,i in enumerate(obj) :
			string += indent * (depth + 1) + printJsonPritty(i, 0) + ": " + printJsonPritty(obj[i], depth + 1).lstrip() + ("," if n < len(obj) - 1 else "") + "\n"
		string += indent * depth + "}"

	if type(obj) is list :
		string += indent * depth + "[\n"
		for n,i in enumerate(obj) :
			string += printJsonPritty(i, depth + 1) + ("," if n < len(obj) - 1 else "") + "\n"
		string += indent * depth + "]"

	if type(obj) is str :
		string = indent * depth + green(f"'{obj}'")

	if obj == None :
		string = indent * depth + "null"

	if type(obj) is int :
		string = indent * depth + aquamarine(str(obj))

	if type(obj) is float :
		string = indent * depth + aquamarine(str(obj))

	if type(obj) is bool :
		string = indent * depth + blue("true" if obj else "false")

	return string

config_path = str(Path.home() / ".config/project-manager/config.json")

def ask(query: str) -> str :
	return input(yellow(query)).strip()

def asknum(query: str) -> int :
	ins = ask(query + "(number) ")

	if ins.isdecimal() :
		return int(ins)

	print("Please input a number")
	return asknum(query)

def askyesno(query: str) -> bool :
	ins = ask(query + "(y/n) ").lower()

	if ins == "y" : return True
	if ins == "n" : return False

	print("Please use 'y' or 'n'")
	return askyesno(query)

def prittyList(items: list[str]) :
	longest = max(len(x) + 1 for x in items)

	width = os.get_terminal_size().columns

	per_line = (width - 1) / longest

	id = 0
	print("", end = " ")
	for i in items :
		print(f"{i:<{longest}}", end = " ")
		id += 1
		if id == per_line :
			print("\n", end = " ")
			id = 0
	print("\n", end = "")

def autocomplete(query: str, possiblilities: list[str]) -> str :
	got: str = input(yellow(query)).strip()
	fil: list[str] = [x for x in possiblilities if x.startswith(got)]
	fil = list(set(fil))

	if len(fil) == 1 :
		print(f"\033[F{yellow(query)}{fil[0]}")
		return fil[0]

	if len(fil) == 0 or got == "" :
		print("Nothing matched, possible values:")
		prittyList(possiblilities)
	elif len(fil) > 1 :
		print("Possibilities:")
		prittyList(fil)

	return autocomplete(query, possiblilities)

try :
	with open(config_path) as f :
		config = json.load(f)
	print("Loaded config")
except FileNotFoundError :
	print("No config file found, creating")
	try :
		os.mkdir(config_path[:config_path.rfind("/")])
	except : ...
	with open(config_path, "w") as f :
		json.dump({
			"langs": [],
			"rm-misplaced": None,
			"packages": {},
			"ideas": [],
			"create-backup": None,
			"templates": {}
		}, f)
	with open(config_path) as f :
		config = json.load(f)
	print("Created & loaded config file")

def saveConfig() :
	with open(config_path, "w") as f :
		json.dump(config, f)

def setConfig(key: str, val: Any) :
	config[key] = val
	saveConfig()

def getConfig(key: str, default: Any) :
	return config[key] if key in config else default

motivation_amount = getConfig("motivation-amount", 0)

if motivation_amount == 0 :
	motivation_amount = asknum("How many motivational lines to give? ")
	setConfig("motivation-amount", motivation_amount)

oncreate = getConfig("on-create", {})
onload = getConfig("on-load", {})

templates: dict = getConfig("templates", {})
ideas = getConfig("ideas", [])

langs = getConfig("langs", [])

if not langs :
	toadd = []
	select = askyesno("There are no language files in the config, would you like to autoselect them? ")
	homedirs = [str(Path.home() / x) for x in os.listdir(Path.home()) if os.path.isdir(Path.home() / x) and x[0] != "."]

	if select :
		toadd = [x for x in homedirs if len(x[len(str(Path.home())):]) < 5]
	else :
		ins = ask("Directories to add: ").strip().split()
		toadd = [x if x.startswith("/") else str(Path.home() / x) for x in ins]

	while True :
		print("Folders that will be added:")
		for i in toadd :
			print(" -", i)
		correct = askyesno("Is this correct? ")

		if correct :
			langs = toadd
			setConfig("langs", toadd)
			break
		else :
			rm = ask("Files to remove: ").strip().split()
			ad = ask("Files to add: ").strip().split()

			rm = [x if x[0] == "/" else str(Path.home() / x) for x in rm]
			ad = [x if x[0] == "/" else str(Path.home() / x) for x in ad]

			for i in rm :
				if i in toadd :
					toadd.pop(toadd.index(i))

			toadd.extend(ad)

langs = [x for x in langs if x.startswith("/")]
setConfig("langs", langs)

print("Loaded langs:")
for i in langs :
	print(" -", i)

print("Checking langs")

packs = getConfig("packages", {})
runs = getConfig("run-scripts", {})
extensions = getConfig("extensions", {})

for i in langs :
	l = i[i.rfind("/")+1:]

	print(f"Checking '{l}'")

	if not l in extensions :
		ex = ask(f"File extension for lang (default = .{l}): ").removeprefix(".")
		ex = ex if ex != "" else l

		extensions[l] = ex
		setConfig("extensions", extensions)

rm_misplaced: bool | None = getConfig("rm-misplaced", None)
misplaced: list[str] = []
no_project_file: list[str] = []

meta_structure: dict[str, str | float | int | list[dict[str, int | str | bool]]] = {
	"main": "",
	"last-modified": -1.0,
	"revision": 0,
	"name": "<not set>",
	"desc": "<not set>",
	"commits": [],
	"todos": [],
	"points": 0
}

create_backup: bool | None = getConfig("create-backups", None)
if create_backup == None :
	create_backup = askyesno("Would you like to ignore folders that have 'backup' in their name? ")

	setConfig("create-backups", create_backup)

projects_in_folder: bool | None = getConfig("projects-in-folder", None)
if projects_in_folder == None :
	projects_in_folder = askyesno("Would you like to move project files all to a signle folder? ")

	setConfig("projects-in-folder", projects_in_folder)

if projects_in_folder and not os.path.isdir(Path.home() / ".config/project-manager/projects") :
	os.mkdir(Path.home() / ".config/project-manager/projects")

def makeCompisitePath(path: str) :

	p = path.split("/")[1:]
	s = ""

	for i in p :
		s += "/" + i
		if not os.path.isdir(s) :
			os.mkdir(s)

def dirTree(start_from: str) -> list[str] :
	inside = os.listdir(start_from)

	ret = []

	for i in inside :
		if os.path.isdir(start_from + "/" + i) :
			ret.extend(dirTree(start_from + "/" + i))
		else :
			ret.append(start_from + "/" + i)

	return ret

if projects_in_folder :
	for i in langs :
		print(i)
		if not os.path.isdir(Path.home() / (".config/project-manager/projects/" + i)) :
			makeCompisitePath(str(Path.home() / (".config/project-manager/projects/" + i)))

	for i in langs :
		for f in os.listdir(i) :
			path: str = i + "/" + f
			if os.path.isfile(path + "/project.json") :
				with open(Path.home() / (".config/project-manager/projects" + path + ".json"), "w") as f :
					with open(path + "/project.json") as r :
						f.write(r.read())
				os.remove(path + "/project.json")
else :
	files = dirTree(str(Path.home() / ".config/project-manager/projects"))
	files_stripped = [x.removeprefix(str(Path.home() / ".config/project-manager/projects")) for x in files]

	for i in files_stripped :
		makeCompisitePath(i[:i.rfind("/")])

		if not os.path.isfile(i[:i.rfind(".")] + "/project.json"):
			with open(i[:i.rfind(".")] + "/project.json", "w") as w :
				with open(str(Path.home() / ".config/project-manager/projects") + i) as r :
					w.write(r.read())

print("Checking project files")
for i in langs :
	for f in os.listdir(i) :
		path: str = i + "/" + f
		if os.path.isfile(path) :
			misplaced.append(path)
		else :
			if projects_in_folder :
				if not os.path.isfile(Path.home() / (".config/project-manager/projects" + path + ".json")) :
					if not "backup" in f or not create_backup :
						no_project_file.append(path)
				else :
					with open(Path.home() / (".config/project-manager/projects" + path + ".json")) as f :
						proj = json.load(f)

					proj["commits"] = [x for x in proj["commits"] if type(x) is dict]

					for m in meta_structure :
						if not m in proj :
							proj[m] = meta_structure[m]

					with open(Path.home() / (".config/project-manager/projects" + path + ".json"), "w") as f :
						json.dump(proj, f)
			else :
				if not os.path.isfile(path + "/project.json") :
					if not("backup" in f) or not(create_backup) :
						no_project_file.append(path)
				else :
					with open(path + "/project.json") as f :
						proj = json.load(f)

					proj["commits"] = [x for x in proj["commits"] if type(x) is dict]

					for m in meta_structure :
						if not m in proj :
							proj[m] = meta_structure[m]

					with open(path + "/project.json", "w") as f :
						json.dump(proj, f)

if rm_misplaced == None :
	print("These files seem to be misplaced:")
	for i in misplaced :
		print(" -", i)
	rm = askyesno("Do you want to remove them? ")
else :
	rm = rm_misplaced

setConfig("rm-misplaced", rm)
if rm :
	for i in misplaced :
		os.remove(i)

if no_project_file :
	print("These files don't have a project file:")
	for i in no_project_file :
		print(" -", i)
	create = askyesno("Do you want to create them? ")

	if create :
		for i in no_project_file :
			meta = meta_structure.copy()
			meta["name"] = i[i.rfind("/")+1:]

			print(printJsonPritty(meta))
			if projects_in_folder :
				with open(Path.home() / ".config/project-manager/projects" / (i + ".json"), "w") as f :
					json.dump(meta, f)
			else :
				with open(i + "/project.json", "w") as f :
					json.dump(meta, f)

def formatText(string: str) :
	new = string.replace("-", " ")
	new = "".join([x.upper() if n == 0 or new[n-1] == " " else x for n,x in enumerate(new)])
	return new

def getMetadata(path: str) :
	if projects_in_folder :
		with open(Path.home() / (".config/project-manager/projects" + path + ".json")) as f :
			return json.load(f)
	else :
		with open(path + "/project.json") as f :
			return json.load(f)

def showMetadata(path: str) :
	project_info = getMetadata(path)

	print("Project metadata:")
	print(printJsonPritty(project_info))
	if projects_in_folder :
		print(f"Metadata stored in: {Path.home()}.config/project-manager/projects{path}.json")
	else :
		print(f"Metadata stored in: {path}/project.json")

def setMetadata(path: str, key: str, value: Any) :
	meta = getMetadata(path)

	meta[key] = value

	if projects_in_folder :
		with open(Path.home() / (".config/project-manager/projects" + path + ".json"), "w") as f :
			json.dump(meta, f)
	else :
		with open(path + "/project.json", "w") as f :
			f.write(json.dumps(meta))

def metaCmd(path: str) :
	showMetadata(path)

	return 1

def packCmd(path: str) -> int :
	lang = path[len(str(Path.home()))+1:path.rfind("/")]

	if not lang in packs :
		packs[lang] = {}
		setConfig("packages", packs)

	commands = packs[lang]

	print("Possible subcommands: add, rm, search, list")
	cmd = autocomplete(f"/project{path[len(str(Path.home())):]}/pack >>> ", ["add", "rm", "list"]).strip().lower()

	if cmd == "add" :
		if not "add" in packs[lang] :
			packs[lang]["add"] = ask("Command to install library: (use $x for library name and $t for target dir) ")
			setConfig("packages", packs)

		lib = ask(f"/project{path[len(str(Path.home())):]}/pack/add | Library to add: ").strip()
		if lib == "" : return 0
		cmd_run = f"cd {path} && {commands["add"].replace("$x", lib).replace("$t", path)}"
	elif cmd == "rm" :
		if not "rm" in packs[lang] :
			packs[lang]["rm"] = ask("Command to remove a library: (use $x for library name and $t for target dir) ")
			setConfig("packages", packs)

		lib = ask(f"/project{path[len(str(Path.home())):]}/pack/rm | Library to remove: ").strip()
		if lib == "" : return 0
		cmd_run = f"cd {path} && {commands["rm"].replace("$x", lib).replace("$t", path)}"
	elif cmd == "search" :
		if not "search" in packs[lang] :
			packs[lang]["search"] = ask("Command to search for a library: (use $x for library name and $t for target dir) ")
			setConfig("packages", packs)

		lib = ask(f"/project{path[len(str(Path.home())):]}/pack/search | Keywords to search: ").strip()
		if lib == "" : return 0
		cmd_run = f"cd {path} && {commands["search"].replace("$x", lib).replace("$t", path)}"
	elif cmd == "list" :
		if not "list" in packs[lang] :
			packs[lang]["list"] = ask("Command to list installed packages: (use $t for project dir) ")
			setConfig("packages", packs)

		cmd_run = f"cd {path} && {commands["list"]}"

	print(f"Running {cmd_run}")
	os.system(cmd_run)

	return 1

def runCmd(path: str) :
	lang = path[len(str(Path.home()))+1:path.rfind("/")]

	if not lang in runs :
		rn = ask("Command to run this project: (use $x for main entry point) ")
		runs[lang] = rn

		setConfig("run-scripts", runs)

	script = runs[lang]
	main = getMetadata(path)["main"]

	if main == "" :
		print("Main entry point not definde, edit the project.json file")
		return

	cmd = f"cd {path} && {script.replace("$x", main)}"

	os.system(cmd)

import time

def generateReadme(path: str) :
	meta = getMetadata(path)

	readme = f"## {meta["name"]}\n"
	readme += meta["desc"] + "\n"

	if len(meta["todos"]) > 0 :
		readme += "\n---\n\n"

		readme += "Todos:\n"
		meta["todos"].sort(key = lambda x: -x["points"])
		for i in meta["todos"] :
			readme += f" - [{"x" if i["completed"] else " "}] {i["label"]} {" ".join(f"`{x}`" for x in i["tags"])}\n"

	readme += "\n---\n\n"

	readme += "Latest commits:\n"
	for i in meta["commits"][::-1] :
		time_str = datetime.fromtimestamp(i["time"], UTC).strftime('%Y/%m/%d %H:%M:%S')
		readme += f" - `{time_str}` \"{i["message"]}\"\n"

	with open(path + "/README.md", "w") as f :
		f.write(readme)

def giveMotivation(lines: list[str], amount = -1) :
	if amount < 0 :
		amount = motivation_amount

	seen = []
	for i in range(amount) :
		ln = random.choice([x for x in lines])
		seen.append(ln)
		ret = os.system(f"cowsay {ln}")

		if ret != 0 :
			print("\033[F" + bold(green(ln)))

def gitCmd(path: str) :
	print("Possible subommands: link, commit, pull, exit, generate")
	cmd = autocomplete(f"/project{path[len(str(Path.home())):]}/git >>> ", ["link", "commit", "pull", "generate", "exit"]).strip()

	if cmd == "exit" :
		return
	if cmd == "link" :
		link = ask(f"/project{path[len(str(Path.home())):]}/git/link | Repository https/ssh: ")

		meta = getMetadata(path)
		meta["commits"].append({
			"message": "First Commit",
			"time": time.time()
		})
		setMetadata(path, "commits", meta["commits"])

		generateReadme(path)

		os.system(f"cd {path} && git remote add origin {link} && git branch -M main && git add . && git commit -m \"First Commit\" && git push --set-upstream origin main")

		print("Linked github repo successfully!")

	elif cmd == "commit" :
		msg = ask(f"/project{path[len(str(Path.home())):]}/git/commit | Commit message: ")

		if not askyesno(f"/project{path[len(str(Path.home())):]}/git/commit | Is this correct? ") :
			return

		cm = getMetadata(path)["commits"]

		cm.append({
			"message": msg,
			"time": time.time()
		})
		setMetadata(path, "commits", cm)

		if askyesno(f"/project{path[len(str(Path.home())):]}/git/commit | Would you like to autogenerate a README.md? ") :
			print(yellow(f"/project{path[len(str(Path.home())):]}/git/commit | Generating README.md"))
			generateReadme(path)

			input(f"/project{path[len(str(Path.home())):]}/git/commit | If you'd like to edit the generated README.md do it now (ENTER to continue)")

		ret = os.system(f"cd {path} && git add . && git commit -m \"{msg}\" && git push")

		if ret == 0 :
			print("Commit pushed successfully!")

			giveMotivation(programming_motivation)
	elif cmd == "pull" :
		ret = os.system(f"cd {path} && git pull")
		if ret == 0 : print("Commit pulled successfully!")
	elif cmd == "generate" :
		generateReadme(path)
		print(green("Generated README.md"))

def showTodo(path: str) :
	todo = getMetadata(path)["todos"]
	points = getMetadata(path)["points"]

	print("This projects todos:")
	for i in todo :
		print(" -", i["label"], f"({i["points"]} points)", "\033[92m(completed)\033[00m" if i["completed"] else "", ("Tags: " + ", ".join(i["tags"]) if len(i["tags"])>0 else ""))
	p_norm = points%30
	print("Points:", p_norm, "[" + "#" * p_norm + "-" * (30 - p_norm) + "]", end = " ")
	print("Level:", int(points / 30))

def todoCmd(path: str) :
	print("Possible subcommands: exit, show, add, mark")
	cmd = autocomplete(f"/project{path[len(str(Path.home())):]}/todo >>> ", ["exit", "show", "add", "mark"])
	todo = getMetadata(path)["todos"]
	points = getMetadata(path)["points"]

	if cmd == "exit" :
		return 1
	elif cmd == "show" :
		showTodo(path)
	elif cmd == "add" :
		label = ask(f"/project{path[len(str(Path.home())):]}/todo/add | This todo's label: ")
		p = ask(f"/project{path[len(str(Path.home())):]}/todo/add | Amount of points to reward: ")
		if not p.isdecimal() :
			print(p, "is not a number")
			return 0

		tags = ask(f"/project{path[len(str(Path.home())):]}/todo/add | This todo's tags: ").split()

		points = int(p)

		todo.append({
			"label": label,
			"points": points,
			"completed": False,
			"tags": tags
		})

		setMetadata(path, "todos", todo)
	elif cmd == "mark" :
		p_label = [x["label"] for x in todo if not x["completed"]]
		label = autocomplete(f"/project{path[len(str(Path.home())):]}/todo/mark | This todo's label: ", p_label)

		for i in todo :
			if i["label"] == label and not i["completed"] :
				i["completed"] = True
				p = getMetadata(path)["points"] + i["points"]
				setMetadata(path, "points", p)
				setMetadata(path, "todos", todo)

				giveMotivation(general_motivation)
				return 0

		print("/project{path[len(str(Path.home())):]}/todo/add | No uncompleted todo named:", label)

	return 0

def getSpot(discovered: list[tuple[int, int]], query: str = "Pick a spot (eg. a1) ") -> tuple[int, int] :
	print("                          ", end = "\r")
	sp = input(query)
	if len(sp) > 2 or not sp[1].isdecimal() or sp[1] > "4" or not sp[0] in "abcd" :
		return getSpot(discovered, "\033[FPlease pick a valid spot! ")

	test = (
		ord(sp[0]) - 97, int(sp[1]) - 1
	)

	if test in discovered :
		return getSpot(discovered, "\033[FPick a non-opened spot ")

	return test

def memoryGame() :
	print("Welcome to memory game!")

	symbols = list("+*|cv-/~")

	grid = [
		["" for x in range(4)] for i in range(4)
	]
	possible = []
	for x in range(4) :
		possible.extend([(x, y) for y in range(4)])

	for i in symbols :
		pos1 = possible.pop(random.randrange(0, len(possible)))
		pos2 = possible.pop(random.randrange(0, len(possible)))

		grid[pos1[1]][pos1[0]] = i
		grid[pos2[1]][pos2[0]] = i

	discover = []
	found = []

	def drawGrid() :
		print("\033[F\033[F\033[F\033[F\033[F\033[F", end = "\r")
		print("  a b c d")
		for n, i in enumerate(grid) :
			print(n+1, *[(green(x) if x in found else x) if (j, n) in discover else "?" for j,x in enumerate(i)])

	for i in range(6) :
		print()

	while len(discover) < 16 :
		drawGrid()

		sp = getSpot(discover)
		discover.append(sp)
		drawGrid()

		sp = getSpot(discover)
		discover.append(sp)
		drawGrid()

		d1, d2 = discover[-1], discover[-2]

		if grid[d1[1]][d1[0]] != grid[d2[1]][d2[0]] :
			discover.pop(-1)
			discover.pop(-1)
		else :
			found.append(grid[d1[1]][d1[0]])

		input("Continue                          ")

	drawGrid()
	print(bold(green("You win!")))

def gameCmd(path: str) :
	games = [memoryGame]

	game = random.choice(games)

	game()

	giveMotivation(back_to_coding_motivation)

	return 1

def projectMode(path: str) :

	lang = path[:path.rfind("/")]

	if not lang in onload :
		onload[lang] = ""
		create = askyesno(f"Lang '{lang}' has not onload command set, would you like ot do it now? ")

		if create :
			cmd = ask("Onload command: (use $t for project path) ")
			onload[lang] = cmd

		setConfig("on-load", onload)

	if onload[lang] != "" :
		cmd = f"cd {path} && {onload[lang].replace("$t", path)}"
		print(f"Running onload command: '{cmd}'")
		os.system(cmd)

	cmds = {
		"meta": metaCmd,
		"pack": packCmd,
		"run": runCmd,
		"git": gitCmd,
		"todo": todoCmd,
		"game": gameCmd
	}

	while True :
		print("Availible commands: meta, open, exit, pack, run, git, todo, game")
		cmd = autocomplete(f"/project{path[len(str(Path.home())):]} >>> ", ["meta", "open", "exit", "pack", "run", "git", "todo", "game"]).strip()

		if cmd == "exit":
			setConfig("last-opened", "")
			return

		ex = 0
		while ex == 0 :
			ex = cmds[cmd](path)

def openProject(path: str) :
	setConfig("last-opened", path)

	last_update = os.stat(path).st_mtime
	meta = getMetadata(path)

	if last_update > meta["last-modified"] :
		setMetadata(path, "last-modified", last_update)
		setMetadata(path, "revision", meta["revision"] + 1)

	showTodo(path)

	giveMotivation(coding_motivation)

	return projectMode(path)

def projectLoadMode() :
	p_langs = [x[x.rfind("/")+1:] for x in langs]

	ins = autocomplete("/project | Project language: ", p_langs)
	if ins == "exit" : return 1

	lang = ins.strip()

	projects = [x for x in os.listdir(Path.home() / lang) if os.path.isdir(Path.home() / lang / x)]
	projects.sort()
	print("Availible projects:")
	prittyList(projects)
	p_projects = projects
	p_projects.extend([x[x.rfind("/")+1:] for x in projects])
	name = autocomplete(f"/project/{lang} | Project name: ", p_projects).strip()

	path = Path.home() / lang / name

	if not os.path.isdir(path) :
		print(f"'{path}' is not a project!")
		return 0

	return openProject(str(path))

def folderEditMode() :
	while True :
		print("Possible subcommands: exit, add, rm, list")
		cmd = autocomplete("/langs >>> ", ["exit", "add", "rm", "list"])

		if cmd == "exit" :
			return

		if cmd == "list" :
			print("Language folders:")
			for i in langs :
				inside = os.listdir(i)

				projects = len([x for x in inside if os.path.isdir(i+"/"+x)])
				files = len([x for x in inside if os.path.isfile(i+"/"+x)])

				info = [x for x in [f"{projects} projects" if projects > 0 else "", f"{files} files" if files > 0 else ""] if x]

				print(" -", i, ("(" + ", ".join(info) + ")") if info else "")
		elif cmd == "add" :
			while True :
				add = ask("/langs/add | Directories to add: ").strip().split()

				add = [x if x[0] == "/" else str(Path.home() / x) for x in add]

				print("These dirs will be added:")
				for i in add :
					print(" -", i)

				correct = askyesno("/langs/add | Is this correct? ")
				if correct :
					langs.extend(add)
					setConfig("langs", langs)
					break
		elif cmd == "rm" :
			while True :
				add = ask("/langs/rm | Directories to remove: ").strip().split()

				add = [x if x[0] == "/" else str(Path.home() / x) for x in add]

				print("These dirs will be removed:")
				for i in add :
					print(" -", i)

				correct = askyesno("/langs/rm | Is this correct? ")
				if correct :
					for i in add :
						if i in langs :
							langs.pop(langs.index(i))
					setConfig("langs", langs)
					break

def configEditMode() :
	cfg = printJsonPritty(config)
	print(cfg)
	print(f"Config stored in '{config_path}'")

def escapeText(string: str) :
	return string.lower().replace(" ", "_")

def createModeNoTempl() :
	while True :
		print("Possible language folders:")
		for i in langs :
			print(" -", i)

		p_langs = langs
		p_langs.extend([x[x.rfind("/")+1:] for x in langs])

		lang = autocomplete("/create | Project language: ", p_langs).strip()
		lang = lang if lang.startswith("/") else str(Path.home() / lang)

		if not lang in langs :
			print(f"'{lang}' is not a registered language folder, please register it as such before continuing")
			return -1

		name = ask("/create | Project name: ").strip()
		name_esc = escapeText(name)
		print(f"Escaped name: {name_esc}")

		desc = ask("/create | Project decsription: ").strip()
		desc = desc if desc != "" else "<not set>"

		path = lang + "/" + name_esc

		ex = extensions[lang[lang.rfind("/")+1:]]

		main = ask(f"/create | Main project entry point (default: {name_esc}.{ex}): ")
		main = main if main != "" else name_esc + "." + ex

		meta = meta_structure.copy()
		meta["name"] = name
		meta["desc"] = desc
		meta["main"] = main

		mt = printJsonPritty(meta)
		print("Meta file created:")
		print(mt)
		correct = askyesno("/create | Is this correct? ")
		if correct :
			break

	os.mkdir(path)

	os.system(f"cd {path} && git init")

	with open(path + "/" + main, "w") as f :
		pass

	if projects_in_folder :
		with open(Path.home() / (".config/project-manager/projects" + path + ".json"), "w") as f :
			json.dump(meta, f)
	else :
		with open(path + "/project.json", "w") as f :
			json.dump(meta, f)

def copyDir(path: str, to: str) :
	inside = [x for x in os.listdir(path)]

	files = [x for x in inside if os.path.isfile(path + "/" + x) and not os.path.islink(path + "/" + x)]
	dirs = [x for x in inside if os.path.isdir(path + "/" + x) and not os.path.islink(path + "/" + x)]

	for i in files :
		with open(to + "/" + i, "w") as f :
			with open(path + "/" + i) as r :
				f.write(r.read())

	for i in dirs :
		os.mkdir(to + "/" + i)
		copyDir(path + "/" + i, to + "/" + i)

def createModeTempl() :
	while True :
		tm = autocomplete("/create | Name of template to use: ", list(templates.keys()))

		templ = templates[tm]

		name = ask("/create | Project name: ").strip()
		name_esc = escapeText(name)
		print(f"/create | Escaped name: {name_esc}")

		desc = ask("/create | Project description: ").strip()
		desc = desc if desc else "<not set>"

		path = templ["lang"] + "/" + name_esc

		meta = meta_structure.copy()
		meta["name"] = name
		meta["desc"] = desc
		meta["main"] = templ["main"]

		mt = printJsonPritty(meta)
		print("Meta file created:")
		print(mt)
		correct = askyesno("/create | Is this correct? ")
		if correct :
			break

	os.mkdir(path)

	print(f"Copying {templ["dir"]} -> {path}")

	copyDir(templ["dir"], path)

	os.system(f"cd {path} && git init")

	if projects_in_folder :
		with open(Path.home() / (".config/project-manager/projects" + path + ".json"), "w") as f :
			json.dump(meta, f)
	else :
		with open(path + "/project.json", "w") as f :
			json.dump(meta, f)

	if templ["cmd"] != "" :
		print("Running pre-package command:", templ["cmd"].replace("$t", path))
		os.system(f"cd {path} && " + templ["cmd"].replace("$t", path))

	ln = path[len(str(Path.home()))+1:path.rfind("/")]
	if not ln in packs :
		packs[ln] = {}
		setConfig("packages", packs)

	if not "add" in packs[ln] :
		packs[ln]["add"] = ask("Command to install library: (use $x for library name and $t for target dir) ")
		setConfig("packages", packs)

	add = packs[ln]["add"]

	print("Getting libraries")

	for i in templ["pack"] :
		cmd = f"cd {path} && {add.replace("$x", i).replace("$t", path)}"
		print(f"Running {cmd}")
		os.system(cmd)

	return path

def createMode() :
	if len(templates) > 0 :
		temp = askyesno("/create | Would you like to use a template? ")
	else :
		temp = False

	if temp :
		path = createModeTempl()
	else :
		path = createModeNoTempl()
		if path == -1 :
			return


	lang = path[:path.rfind("/")]

	if not lang in oncreate :
		oncreate[lang] = ""
		create = askyesno(f"Lang '{lang}' has not oncreate command set, would you like ot do it now? ")

		if create :
			cmd = ask("Oncreate command: (use $t for project path) ")
			oncreate[lang] = cmd

		setConfig("on-create", oncreate)

	if oncreate[lang] != "" :
		cmd = f"cd {path} && {oncreate[lang].replace("$t", path)}"
		print(f"Running oncreate command: '{cmd}'")
		os.system(cmd)

	return projectMode(str(path))

def ideaMode() :

	while True :

		print("Possible subcommands: exit, make, show, rm")
		cmd = autocomplete("/ideas >>> ", ["exit", "make", "show", "rm"])

		if cmd == "exit" :
			break
		elif cmd == "show" :
			print("Saved project ideas:")
			for i in ideas :
				print(" -", i["name"])
				print(" ", " ", i["desc"])
		elif cmd == "make" :
			name = ask("/ideas/add | Idea name: ")
			desc = ask("/ideas/add | Idea description: ")

			ideas.append({
				"name": name,
				"desc": desc
			})

			setConfig("ideas", ideas)
		elif cmd == "rm" :
			possible = [x["name"] for x in ideas]
			id = autocomplete("/ideas/rn | Name if idea to remove: ", possible)

			for n,i in enumerate(ideas) :
				if i["name"] == id :
					ideas.pop(n)

			setConfig("ideas", ideas)

def templateMode() :
	while True :
		print("Possible subcommands: exit, show, add, rm")
		cmd = autocomplete("/tmpl >>> ", ["exit", "show", "add", "rm"])

		if cmd == "exit" :
			return
		elif cmd == "show" :
			pritty = printJsonPritty(templates)
			print("Templates:")
			print(pritty)
		elif cmd == "add" :
			while True :
				name = escapeText(ask("/tmpl/add | Template Name: "))
				print(f"/tmpl/add | Name set as '{name}'")

				p_langs = langs
				p_langs.extend([x[x.rfind("/")+1:] for x in langs])

				base_lang = autocomplete("/tmpl/add | Template base language: ", p_langs)
				base_lang = base_lang if base_lang.startswith("/") else str(Path.home() / base_lang)

				dir = ask("/tmpl/add | Template directory: ").strip()
				dir = dir if dir.startswith("/") else str(Path.home() / dir)

				entry = ask(f"/tmpl/add | Main entry point (default: main.{extensions[base_lang[base_lang.rfind("/")+1:]]}): ")
				entry = entry if entry else f"main.{extensions[base_lang[base_lang.rfind("/")+1:]]}"

				cmd = ask("/tmpl/add | OnCreate command: ").strip()
				packages = ask("/tmpl/add | Packages to install automatically: ").strip().split()

				temp = {
					"lang": base_lang,
					"dir": dir,
					"main": entry,
					"cmd": cmd,
					"pack": packages
				}

				mt = printJsonPritty(temp)
				print("Template file created: ")
				print(green(f"'{name}'") + ":", mt)
				correct = askyesno("/tmpl/add | Is this correct? ")
				if correct :
					templates[name] = temp
					setConfig("templates", templates)
					break
		elif cmd == "rm" :
			name = autocomplete("/tmpl/rm | Template to remove: ", list(templates.keys()))
			templates.pop(name)
			setConfig("templates", templates)

DOCS = [
	{
		"name": "exit",
		"desc": "Closes the program",
		"longdesc": "Closes the program"
	},
	{
		"name": "langs",
		"desc": "Manages language folders",
		"longdesc": "Contains subcommands to manage language folders",
		"sub": [
			{
				"name": "add",
				"desc": "Adds language folders",
				"longdesc": "When given directories it will add them to the language folders"
			},
			{
				"name": "rm",
				"desc": "Removes language folders",
				"longdesc": "When given directories it will remove them from the language folders"
			},
			{
				"name": "list",
				"desc": "Lists all language folders",
				"longdesc": "Lists all language folders"
			}
		]
	},
	{
		"name": "project",
		"desc": "Opens and manages projects",
		"longdesc": "Opens a project and has tools to manage important parts of a project",
		"sub": [
			{
				"name": "meta",
				"desc": "Shows a project's metadata",
				"longdesc": "Shows a project's metadata"
			},
			{
				"name": "pack",
				"desc": "Managed dependencies",
				"longdesc": "Provides commands to install, remove and list dependencies",
				"sub": [
					{
						"name": "add",
						"desc": "Adds a dependency",
						"longdesc": "Adds a dependency with the current project's default package manager"
					},
					{
						"name": "rm",
						"desc": "Removes a dependency",
						"longdesc": "Removes a dependency with the current project's default package manager"
					},
					{
						"name": "list",
						"desc": "Lists all dependencies",
						"longdesc": "Lists all dependencies with the current project's default package manager"
					},
					{
						"name": "search",
						"desc": "Searches for a library",
						"longdesc": "Searches for a library with the current project's default package manager"
					}
				]
			},
			{
				"name": "git",
				"desc": "Provides commands to manage version control",
				"longdesc": "Provides command to link and commit to a github repository",
				"sub": [
					{
						"name": "link",
						"desc": "Links a project with a github repo",
						"longdesc": "Automatically link this project with the specified github repository"
					},
					{
						"name": "commit",
						"desc": "Commits to the linked githube repository",
						"longdesc": "Adds all files, commits with the specified message and then pushes, also gives a motivational line"
					},
					{
						"name": "pull",
						"desc": "Pulls the linked repository",
						"longdesc": "Pulls the linked repository"
					},
					{
						"name": "generate",
						"desc": "Generate README.md",
						"longdesc": "Generates the README.md file based on the projects metadata"
					}
				]
			},
			{
				"name": "todo",
				"desc": "Manages a project's todos",
				"longdesc": "Provides commands to add and mark todos",
				"sub": [
					{
						"name": "add",
						"desc": "Adds a todo",
						"longdesc": "Adds a todo with the specified name, tags and points to award"
					},
					{
						"name": "mark",
						"desc": "Marks a todo as completed",
						"longdesc": "Marks a todo as completed and awards the todo's points, also gives a motivational line"
					},
					{
						"name": "show",
						"desc": "Shows all todos",
						"longdesc": "Shows all ot the project's todos as well as the amount of points earned"
					}
				]
			},
			{
				"name": "run",
				"desc": "Runs the project",
				"longdesc": "Runs the project"
			},
			{
				"name": "game",
				"desc": "Plays a random minigame",
				"longdesc": "Lets the user relax for a bit by playing a little game"
			}
		]
	},
	{
		"name": "config",
		"desc": "Shows the user's config file",
		"longdesc": "Shows the user's config file and its location"
	},
	{
		"name": "create",
		"desc": "Creates a new project",
		"longdesc": "Creates a project, if a templatee has been defined asks the user if they want to use one"
	},
	{
		"name": "ideas",
		"desc": "Lets the user write down ideas",
		"longdesc": "Lets the user write down ideas",
		"sub": [
			{
				"name": "show",
				"desc": "Shows all project ideas",
				"longdesc": "Shows all project ideas",
			},
			{
				"name": "make",
				"desc": "Adds a new idea",
				"longdesc": "Prompts the user with an idea's label and then adds it"
			},
			{
				"name": "rm",
				"desc": "Removes a project idea",
				"longdesc": "Removes a project idea"
			}
		]
	},
	{
		"name": "templ",
		"desc": "Manages project templates",
		"longdesc": "Adds and removes project templates",
		"sub": [
			{
				"name": "add",
				"desc": "Creates a project template",
				"longdesc": "Creates a project template",
			},
			{
				"name": "rm",
				"desc": "Removes a project template",
				"longdesc": "Removes a project template",
			},
			{
				"name": "show",
				"desc": "Lists all project templates",
				"longdesc": "Lists all project templates",
			}
		]
	},
	{
		"name": "help",
		"desc": "Show help messages",
		"longdesc": "Shows help messages for every command"
	}
]

def showInfo(pos: str, info: dict) :
	print((pos + " > " if pos != "" else "") + bold(info["name"]))
	print("", info["longdesc"])

	if "sub" in info :
		print()
		print("Possible subcommands:")
		longest = max(len(x["name"]) for x in info["sub"])
		for i in info["sub"] :
			print("", f"{i["name"]:<{longest}}", "", i["desc"])

		p = [""]
		p.extend(x["name"] for x in info["sub"])

		sub = autocomplete(f"/help/{info["name"]} | Subcommand to provide help on: ", p)

		subcommand = {}
		for i in info["sub"] :
			if i["name"] == sub :
				subcommand = i

		showInfo((pos + " > " if pos != "" else "") + info["name"], subcommand)

def helpMode() :
	longest = max(len(x["name"]) for x in DOCS)
	for i in DOCS :
		print("", f"{i["name"]:<{longest}}", "", i["desc"])

	sec = autocomplete(f"/help | Section to provide info on: ", [x["name"] for x in DOCS])

	info = {}
	for i in DOCS :
		if i["name"] == sec :
			info = i

	showInfo("", info)

def interactiveMode() :
	print("(exit to close) Select a mode, possible modes: langs, project, config, create, ideas, templ, help")
	mode = autocomplete("/ >>> ", ["exit", "langs", "project", "config", "create", "ideas", "templ", "help"])

	if mode == "exit": exit()

	func = None
	if mode == "project" :
		func = projectLoadMode
	elif mode == "langs" :
		func = folderEditMode
	elif mode == "config" :
		func = configEditMode
	elif mode == "create" :
		func = createMode
	elif mode == "ideas" :
		func = ideaMode
	elif mode == "templ" :
		func = templateMode
	elif mode == "help" :
		func = helpMode

	if func :
		func()

last_open = getConfig("last-opened", "")

if last_open != "" :
	print(yellow(f"Opening '{last_open}'"))
	openProject(last_open)

while True :
	interactiveMode()
